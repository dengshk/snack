<?xml version="1.0" encoding="UTF-8" ?>   
<!DOCTYPE mapper   
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.snack.web.dao.record.ProOrderLogDao">

	<!-- 销售信息 开始 -->
	<sql id="whereCondition">
		select
			a.`id` id,
		    a.`flow_id` flowId,
		    a.`product_id` productId,
		    a.`type_id` typeId,
		    b.`type_name` typeName,
		    a.`product_name` productName,
		    format(a.`cost_price`,2) costPrice,
		    format(a.`sale_price`,2) salePrice,
		    a.`order_num` orderNum,
		    a.`type` type,
		    a.`order_date` orderDate,
		    a.`create_time` createTime
		from t_snack_order_log a,t_snack_product_classify b
		where a.`type_id`=b.`type_id`
		<if test="flowId != null">
			and a.`flow_id` = #{flowId,jdbcType=VARCHAR}
		</if>
		<if test="type != null">
			and a.`type` = #{type,jdbcType=VARCHAR}
		</if>
		order by a.`order_date` desc
    </sql>
    
    <select id="queryForCount" parameterType="map" resultType="java.lang.Integer">
		select count(b.flowId)
  			from (<include refid="whereCondition"/> ) b
	</select>

 <select id="queryForList" parameterType="map" resultType="com.shop.snack.web.model.ProOrderLog">
   <![CDATA[
	   select a.*
		          from (
	 ]]>
		<include refid="whereCondition"/>	         
    <![CDATA[
		   ) a
		       limit #{lbound},#{pageSize} 
	]]>
   </select>

   <select id="queryById" parameterType="map" resultType="com.shop.snack.web.model.ProOrderLog">
	  <include refid="whereCondition"/>
   </select>
   
   <!-- 物理删除用户 -->
   <update id="deleteOne" parameterType="map">
   		delete from  t_snack_order_log
   		where `id` = #{id,jdbcType=DECIMAL}
   </update>
</mapper>